<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>CardMoney</title>
    <style>
        body {
            background: linear-gradient(135deg, #6b73ff, #000dff);
            color: #ffffff;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            text-align: center;
            user-select: none;
            overflow: hidden;
            position: relative;
        }

        .header {
            margin-top: 20px;
            font-size: 2em;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            animation: shine 2s infinite;
            position: relative;
            z-index: 1;
        }

        @keyframes shine {
            0% { color: #ffffff; }
            50% { color: #ffd700; }
            100% { color: #ffffff; }
        }

        .balance {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 1.2em;
            margin-top: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .balance span {
            margin-right: 10px;
        }

        .add-button {
            background-color: #007bff;
            border: none;
            color: white;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 20px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s, background-color 0.3s;
        }

        .add-button:hover {
            background-color: #0056b3;
            transform: scale(1.1);
        }

        .menu {
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            width: 100%;
            position: relative;
        }

        .menu-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            width: 100%;
            max-width: 300px;
            padding: 20px;
            border: 2px solid #ffffff;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
            background: linear-gradient(135deg, #6b73ff, #000dff);
        }

        .menu button {
            background: linear-gradient(135deg, #4caf50, #8bc34a);
            color: #ffffff;
            border: none;
            padding: 15px 30px;
            font-size: 1.2em;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s;
            width: 100%;
            border-radius: 25px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .menu button:hover {
            background: linear-gradient(135deg, #66bb6a, #9ccc65);
            transform: scale(1.05);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: rgba(0, 0, 0, 0.9);
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.2s;
        }

        .modal-content {
            background-color: #1e1e1e;
            border-radius: 10px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            width: 90%;
            max-width: 500px;
            border: 2px solid #ffffff;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
            overflow-y: auto;
            animation: fadeIn 0.2s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .close {
            color: #aaaaaa;
            font-size: 28px;
            font-weight: bold;
            position: absolute;
            top: 10px;
            right: 15px;
            cursor: pointer;
            z-index: 2;
        }

        .deck-container {
            display: flex;
            flex-direction: row;
            gap: 20px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .deck {
            width: 150px;
            height: 250px;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            background-color: #555555;
            cursor: pointer;
            transition: transform 0.2s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .deck:hover {
            transform: scale(1.05);
        }

        .deck-image {
            width: 100%;
            height: 100%;
            border-radius: 10px;
            object-fit: cover;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 0;
        }

        .deck-name {
            font-size: 1.2em;
            position: relative;
            z-index: 1;
            color: #ffffff;
            margin-top: 0;
            margin-bottom: 5px;
            text-align: left;
            width: 90%;
            margin-left: 10%;
            -webkit-text-stroke: 1px black;
        }

        .card-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
        }

        .card {
            width: 100%;
            height: 200px;
            border-radius: 10px;
            position: relative;
            overflow: hidden;
            background-color: transparent;
            cursor: pointer;
            transition: transform 0.2s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .card:hover {
            transform: scale(1.05);
        }

        .card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
        }

        .card-name {
            font-size: 1.2em;
            font-weight: bold;
            position: absolute;
            z-index: 2;
            color: #ffffff;
            text-align: center;
            bottom: 50px;
            -webkit-text-stroke: 1px black;
        }

        .card-count {
            font-size: 1em;
            position: absolute;
            z-index: 2;
            color: #ffffff;
            text-align: center;
            bottom: 10px;
        }

        .valet {
            box-shadow: 0 0 20px rgba(180, 115, 30, 1.0);
        }

        .dama {
            box-shadow: 0 0 20px rgba(192, 192, 192, 1.0);
        }

        .king {
            box-shadow: 0 0 20px rgba(255, 215, 0, 1.0);
        }

        .tuz {
            box-shadow: 0 0 20px rgba(0, 255, 255, 1.0);
        }

        #game-container {
            background-color: #282c34;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            padding: 20px;
            width: 100%;
            max-width: 800px;
            margin: 20px auto;
            display: none;
            position: relative;
            top: 50%;
            transform: translateY(-50%);
            animation: fadeIn 0.2s;
        }

        #grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            aspect-ratio: 1;
            height: 500px;
            margin: 0 auto;
        }

        .cell {
            background-color: #1e3a34;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            color: white;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s, transform 0.2s;
            aspect-ratio: 1;
            overflow: hidden;
        }

        .cell:hover {
            background-color: #1a5246;
            transform: scale(1.05);
        }

        .game-over {
            background-color: #dc3545;
        }

        .bonus-cell {
            background-color: #ffc107;
        }

        .hidden {
            display: none;
        }

        #slider {
            margin: 20px;
            width: 80%;
        }

        .reward-message {
            font-size: 1.5em;
            margin: 20px;
            color: #00ff00;
            animation: fadeIn 0.2s;
        }

        .button-container {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        .mine-count-container {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 20px;
        }

        .mine-count-label {
            font-size: 1.2em;
            margin-right: 10px;
        }

        .mine-count-value {
            font-size: 1.2em;
            margin-left: 10px;
        }

        .mine-count-slider {
            width: 80%;
            margin-left: 10px;
        }

        .welcome-modal {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
            background-color: #1e1e1e;
            border-radius: 10px;
            border: 2px solid #ffffff;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
            max-width: 500px;
            width: 90%;
            animation: fadeIn 0.2s;
        }

        .welcome-modal img {
            width: 100%;
            height: auto;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .welcome-modal h2 {
            font-size: 1.5em;
            margin-bottom: 20px;
        }

        .welcome-modal p {
            font-size: 1.2em;
            margin-bottom: 20px;
        }

        .quest-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .quest {
            border: 2px solid #ffffff;
            border-radius: 10px;
            padding: 20px;
            background-color: #333333;
            cursor: pointer;
            transition: background-color 0.3s ease;
            position: relative;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .quest:hover {
            background-color: #444444;
        }

        .quest-name {
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        .quest-reward {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }

        .add-card-button {
            background-color: #007bff;
            border: none;
            color: white;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 20px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s, background-color 0.3s;
        }

        .add-card-button:hover {
            background-color: #0056b3;
            transform: scale(1.1);
        }

        .add-card-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            width: 120px;
            height: 180px;
            padding: 20px;
            border: 2px solid #ffffff;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
            margin-top: 20px;
            justify-content: center;
            background: linear-gradient(135deg, #6b73ff, #000dff);
        }

        button {
            background: linear-gradient(135deg, #4caf50, #8bc34a);
            border: none;
            color: white;
            padding: 10px 15px;
            text-align: center;
            display: inline-block;
            font-size: 16px;
            border-radius: 25px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
            width: 100%;
            margin-top: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        button:hover {
            background: linear-gradient(135deg, #66bb6a, #9ccc65);
            transform: scale(1.05);
        }

        h3, h2 {
            margin: 0;
            font-weight: normal;
        }

        h3 {
            font-size: 20px;
        }

        h2 {
            font-size: 24px;
        }

        input[type="number"] {
            width: 60px;
            margin-left: 10px;
            text-align: center;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        @media (max-width: 768px) {
            .header {
                font-size: 1.5em;
            }

            .balance {
                font-size: 1em;
            }

            .menu-container {
                padding: 10px;
            }

            .menu button {
                font-size: 1em;
                padding: 10px;
            }

            .deck-container {
                gap: 10px;
            }

            .deck {
                height: 200px;
            }

            .deck-name {
                font-size: 1em;
            }

            .card-container {
                gap: 10px;
            }

            .card {
                height: 250px;
            }

            .card-name {
                font-size: 1.2em;
            }

            .card-count {
                font-size: 0.8em;
            }

            #game-container {
                padding: 10px;
                max-width: 100%;
                transform: scale(0.66);
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
            }

            #grid {
                height: 300px;
            }

            .cell {
                font-size: 18px;
            }

            .mine-count-container {
                margin-top: 10px;
            }

            .mine-count-label {
                font-size: 1em;
            }

            .mine-count-value {
                font-size: 1em;
            }

            .mine-count-slider {
                width: 70%;
            }

            .welcome-modal {
                padding: 10px;
            }

            .welcome-modal img {
                margin-bottom: 10px;
            }

            .welcome-modal h2 {
                font-size: 1.2em;
            }

            .welcome-modal p {
                font-size: 1em;
            }

            .quest-container {
                gap: 10px;
            }

            .quest {
                padding: 10px;
            }

            .quest-name {
                font-size: 1em;
            }

            .add-card-button {
                width: 30px;
                height: 30px;
                font-size: 16px;
            }

            button {
                font-size: 14px;
                padding: 8px;
            }

            h3 {
                font-size: 18px;
            }

            h2 {
                font-size: 20px;
            }

            input[type="number"] {
                width: 50px;
            }
        }

        .snowflake {
            position: absolute;
            width: 10px;
            height: 10px;
            background: transparent;
            opacity: 0.8;
            animation: fall linear infinite;
            font-size: 10px;
            line-height: 10px;
            text-align: center;
            color: white;
        }

        @keyframes fall {
            from {
                transform: translateY(0) rotate(0deg);
            }
            to {
                transform: translateY(100vh) rotate(360deg);
            }
        }

        .snow-toggle {
            position: relative;
            background-color: #ffffff;
            border: none;
            color: #000000;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transition: background-color 0.3s, transform 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .snow-toggle:hover {
            background-color: #dddddd;
            transform: scale(1.1);
        }

        .version {
            position: absolute;
            bottom: 10px;
            right: 10px;
            font-size: 12px;
            color: #ffffff;
            opacity: 0.5;
        }
    </style>
</head>
<body>
    <div class="header">CardMoney</div>
    <div class="balance">
        <div style="display: flex; align-items: center; margin-bottom: 10px;">
            <span>💰</span>
            <span id="totalBalance">0</span>
        </div>
        <div style="display: flex; align-items: center;">
            <span>💎</span>
            <span id="diamondBalance">0</span>
        </div>
    </div>
    <div class="menu-container">
        <div class="balance" style="margin-bottom: 20px;">
            <div style="display: flex; align-items: center; margin-bottom: 10px;">
                <span>💰</span>
                <span id="totalBalanceMenu">0</span>
            </div>
            <div style="display: flex; align-items: center;">
                <span>💎</span>
                <span id="diamondBalanceMenu">0</span>
            </div>
        </div>
        <button onclick="openGameSelectionModal()">Играть</button>
        <button onclick="openDeckModal()">Колоды</button>
        <button onclick="openQuestModal()">Задания</button>
        <button onclick="openSettingsModal()">Настройки</button>
    </div>

    <div id="gameSelectionModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeGameSelectionModal()">&times;</span>
            <h2>Выберите игру</h2>
            <button onclick="playGuessTheCellGame()">Угадай клетку</button>
        </div>
    </div>

    <div id="adModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeAdModal()">&times;</span>
            <h2>Посмотреть рекламу</h2>
            <p>За просмотр рекламы дается 2 попытки и шанс получить любую карту!</p>
            <button onclick="watchAd()">Смотреть рекламу</button>
        </div>
    </div>

    <div id="deckModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeDeckModal()">&times;</span>
            <h2>Колоды</h2>
            <div class="deck-container" style="display: flex; align-items: center;">
                <div class="deck" onclick="openClassicDeck()">
                    <img class="deck-image" src="https://i.pinimg.com/originals/a4/d4/ac/a4d4ac0acc9bfdf7a30beeb23170ce24.jpg" alt="Классическая колода">
                    <span class="deck-count" id="classicDeckCount">x0</span>
                    <div class="deck-name">Классическая</div>
                </div>
                <div class="add-card-container" style="width: 120px; height: 180px;">
                    <button class="add-card-button" onclick="openAddCardModal()">+</button>
                </div>
            </div>
        </div>
    </div>

    <div id="addCardModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeAddCardModal()">&times;</span>
            <h2>Добавить свою карту</h2>
            <p>Дорогой игрок, если ты хочешь создать свою карту и её видели все игроки, переведи сумму от 50 руб на счет Сбер +79782464846, и введи с сообщением описание своей карты, и карта в скором времени будет добавлена в игру.</p>
            <button onclick="closeAddCardModal()">ОК</button>
        </div>
    </div>

    <div id="classicDeckModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeClassicDeckModal()">&times;</span>
            <h2>Карты Классической Колоды</h2>
            <div class="card-container">
                <div class="card valet" onclick="showCardInfo('Валет', 'Обычная карта', 'x0', 'Уменьшает таймер на 5%')">
                    <img src="https://i.postimg.cc/2ybJZLyC/5424615245164440207.jpg" alt="Валет">
                    <span class="card-count">x0</span>
                    <div class="card-name">Валет</div>
                </div>
                <div class="card dama" onclick="showCardInfo('Дама', 'Необычная карта', 'x0', 'Увеличивает шанс появления бонусной клетки на 5%')">
                    <img src="https://i.postimg.cc/QxpD4vNh/5422821976059276714.jpg" alt="Дама">
                    <span class="card-count">x0</span>
                    <div class="card-name">Дама</div>
                </div>
                <div class="card king" onclick="showCardInfo('Король', 'Великая карта', 'x0', 'Потенциальный двойной выигрыш на 3%')">
                    <img src="https://i.postimg.cc/3NmsqDTn/5422821976059276715.jpg" alt="Король">
                    <span class="card-count">x0</span>
                    <div class="card-name">Король</div>
                </div>
                <div class="card tuz" onclick="showCardInfo('Туз', 'ИМБОВАЯ карта', 'x0', 'Возможность поставить 0 пустых клеток')">
                    <img src="https://i.postimg.cc/tCt0tPDg/5422821976059276716.jpg" alt="Туз">
                    <span class="card-count">x0</span>
                    <div class="card-name">Туз</div>
                </div>
            </div>
        </div>
    </div>

    <div id="cardInfoModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeCardInfoModal()">&times;</span>
            <h2 id="cardTitle" style="text-align: center;"></h2>
            <p id="cardRarity" style="font-size: 1.2em; text-align: center;"></p>
            <p id="cardAbility" style="text-align: center;"></p>
            <p id="cardCountUpgrade" style="text-align: center;"></p>
            <button onclick="upgradeCard()" id="upgradeButton" class="hidden">Улучшить (50 монет)</button>
        </div>
    </div>

    <div id="questModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeQuestModal()">&times;</span>
            <h2>Задания</h2>
            <div class="quest-container">
                <div class="quest" onclick="openQuestInfo('Тёте нужно помогать!', 'Соберите все 4 вида карт: Валет, Дама, Король, Туз.')">
                    <div class="quest-name">Тёте нужно помогать!</div>
                    <div class="quest-progress">0/4</div>
                </div>
            </div>
        </div>
    </div>

    <div id="questInfoModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeQuestInfoModal()">&times;</span>
            <h2 id="questTitle" style="text-align: center;"></h2>
            <p id="questDescription" style="font-size: 1.2em; text-align: center;"></p>
            <button id="questRewardButton" class="hidden" onclick="claimQuestReward()">Получить награду</button>
        </div>
    </div>

    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeSettingsModal()">&times;</span>
            <h2>Настройки</h2>
            <div>
                <label for="languageSelect">Выберите язык:</label>
                <select id="languageSelect" onchange="changeLanguage()">
                    <option value="ru">Русский</option>
                    <option value="en">English</option>
                </select>
            </div>
            <div style="margin-top: 20px; display: flex; flex-direction: column; align-items: center;">
                <label for="snowToggle" style="margin-bottom: 10px; text-align: center;">Включить/выключить снег:</label>
                <button class="snow-toggle" style="width: 40px; height: 40px;" onclick="toggleSnow()">🌨</button>
            </div>
            <button onclick="window.location.href='https://t.me/chatdlaobshenia7'">Нашел баг?</button>
        </div>
    </div>

    <div id="game-container" style="transform: scale(0.66); position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
        <div id="header">
            <h3 style="display: flex; align-items: center; justify-content: center;">
                <span>Попытки:</span>
                <span id="attempts">5</span>
                <button class="add-button" style="width: 20px; height: 20px; font-size: 16px; margin-left: 5px; margin-right: 5px; transform: scale(1.25);" onclick="openAdModal()">+</button>
            </h3>
            <h2>Угадайте, где спрятаны монеты!</h2>
            <h3 id="freeAttempt" class="hidden">Бесплатная попытка: <span id="attemptResetTimer">02:00</span></h3>
        </div>
        <div id="grid"></div>
        <div class="mine-count-container">
            <label for="mineCount" class="mine-count-label">Пустые клетки (3-24):</label>
            <span id="mineCountDisplay" class="mine-count-value">3</span>
            <input type="range" min="3" max="24" value="3" class="mine-count-slider" oninput="updateMineCount(this.value)">
        </div>
        <button id="confirmMineCount" onclick="confirmMineCount()">Подтвердить</button>
        <div class="button-container">
            <button id="startButton" onclick="startGame()">Начать игру</button>
            <button id="cashOut" onclick="cashOut()" class="hidden">Забрать <span id="cashOutAmount">0</span> монет</button>
        </div>
        <button id="exitButton" onclick="exitGame()">Выйти в главное меню</button>
        <div id="rewardMessage" class="reward-message hidden"></div>
    </div>

    <div id="welcomeModal" class="modal">
        <div class="welcome-modal">
            <h2>Тетушка Рита</h2>
            <img src="https://i.postimg.cc/xTCRK4Q1/5429354947734006432.jpg" alt="Тетушка Рита">
            <p>Привет, поможешь мне собрать всю коллекцию карт играя в эту простую аркадную игру?</p>
            <button onclick="closeWelcomeModal()">Хорошо</button>
        </div>
    </div>

    <div class="version">v0.2</div>

    <script>
        let totalScore = 0;
        let diamondCount = 0;
        let currentTempScore = 0;
        let mineCount = 3;
        let attempts = 5;
        let grid = [];
        let usedCells = new Set();
        let timerInterval;
        let bonusCellChance = 0.1;
        let bonusCellIndex;
        let gameInProgress = false;
        let snowEnabled = false;
        let cards = {
            'Валет': { count: 0, level: 0, upgradeCost: 50 },
            'Дама': { count: 0, level: 0, upgradeCost: 100 },
            'Король': { count: 0, level: 0, upgradeCost: 150 },
            'Туз': { count: 0, level: 0, upgradeCost: 200 }
        };

        const clickSound = new Audio('https://www.soundjay.com/button/beep-07.wav');
        const winSound = new Audio('https://www.soundjay.com/button/sounds/bell-ring-01.wav');
        const loseSound = new Audio('https://www.soundjay.com/button/sounds/buzzer-02.wav');

        function openGameSelectionModal() {
            document.getElementById('gameSelectionModal').style.display = 'flex';
        }

        function closeGameSelectionModal() {
            document.getElementById('gameSelectionModal').style.display = 'none';
        }

        function playGuessTheCellGame() {
            closeGameSelectionModal();
            document.querySelector('.menu-container').style.display = 'none';
            document.getElementById('game-container').style.display = 'block';
            document.querySelector('.header').style.display = 'none';
            document.getElementById('rewardMessage').classList.add('hidden');
            document.getElementById('rewardMessage').innerText = '';
            toggleCellClickability(false);
            gameInProgress = false;
            startFreeAttemptTimer();
        }

        function exitGame() {
            document.getElementById('game-container').style.display = 'none';
            resetGame();
            document.querySelector('.menu-container').style.display = 'flex';
            document.querySelector('.header').style.display = 'block';
        }

        function openAdModal() {
            document.getElementById('adModal').style.display = 'flex';
        }

        function closeAdModal() {
            document.getElementById('adModal').style.display = 'none';
        }

        function watchAd() {
            attempts += 2;
            document.getElementById('attempts').innerText = attempts;
            saveGameState();

            if (Math.random() < 0.01) {
                const cardNames = Object.keys(cards);
                const randomCard = cardNames[Math.floor(Math.random() * cardNames.length)];
                cards[randomCard].count++;
                updateDeckCount();
                showRewardMessage(`Поздравляю! Вы получили ${randomCard}!`);
            }

            closeAdModal();
        }

        function openDeckModal() {
            document.getElementById('deckModal').style.display = 'flex';
        }

        function closeDeckModal() {
            document.getElementById('deckModal').style.display = 'none';
        }

        function openClassicDeck() {
            document.getElementById('classicDeckModal').style.display = 'flex';
            updateDeckCount();
        }

        function closeClassicDeckModal() {
            document.getElementById('classicDeckModal').style.display = 'none';
        }

        function openAddCardModal() {
            document.getElementById('addCardModal').style.display = 'flex';
        }

        function closeAddCardModal() {
            document.getElementById('addCardModal').style.display = 'none';
        }

        function updateDeckCount() {
            document.getElementById('classicDeckCount').innerText = `x${cards['Валет'].count + cards['Дама'].count + cards['Король'].count + cards['Туз'].count}`;
            document.querySelectorAll('.card-count').forEach(countElement => {
                const cardName = countElement.parentElement.querySelector('.card-name').innerText;
                countElement.innerText = `x${cards[cardName].count}`;
            });
        }

        function startGame() {
            if (attempts <= 0) return;
            if (!gameInProgress) {
                showRewardMessage('Пожалуйста, подтвердите количество пустых клеток.');
                return;
            }

            currentTempScore = 0;
            document.getElementById('cashOutAmount').innerText = currentTempScore;

            mineCount = parseInt(document.getElementById('mineCountDisplay').innerText);
            grid = Array(25).fill(0);

            let placedMines = 0;
            while (placedMines < mineCount) {
                const index = Math.floor(Math.random() * 25);
                if (grid[index] === 0) {
                    grid[index] = -1;
                    placedMines++;
                }
            }

            if (Math.random() < bonusCellChance) {
                do {
                    bonusCellIndex = Math.floor(Math.random() * 25);
                } while (grid[bonusCellIndex] === -1);
                grid[bonusCellIndex] = 1;
                showRewardMessage('Бонусная клетка появилась на поле!');
            }

            renderGrid();
            attempts--;
            document.getElementById('attempts').innerText = attempts;
            document.getElementById('freeAttempt').classList.remove('hidden');
            startTimer();
            toggleCellClickability(true);
            gameInProgress = true;
            saveGameState();
        }

        function renderGrid() {
            const gridContainer = document.getElementById('grid');
            gridContainer.innerHTML = '';

            grid.forEach((cell, index) => {
                const cellDiv = document.createElement('div');
                cellDiv.className = 'cell';
                cellDiv.onclick = () => {
                    cellClicked(index);
                };
                cellDiv.innerHTML = '';
                gridContainer.appendChild(cellDiv);
            });
        }

        function toggleCellClickability(isClickable) {
            const cells = document.querySelectorAll('.cell');
            cells.forEach(cell => {
                cell.style.pointerEvents = isClickable ? 'auto' : 'none';
            });
        }

        function cellClicked(index) {
            if (usedCells.has(index)) return;

            const cellDiv = document.querySelectorAll('.cell')[index];
            usedCells.add(index);

            if (grid[index] === -1) {
                cellDiv.classList.add('game-over');
                cellDiv.innerHTML = '❌';
                showAllMines();
                endGame(false);
                loseSound.play();
            } else if (grid[index] === 1) {
                const extraAttempts = Math.floor(Math.random() * 3) + 1;
                attempts += extraAttempts;
                cellDiv.classList.add('bonus-cell');
                cellDiv.innerHTML = `🎁 +${extraAttempts}`;
                document.getElementById('attempts').innerText = attempts;
                clickSound.play();
            } else {
                const reward = 1 + Math.floor((mineCount - 3) * 0.5);
                currentTempScore += reward;
                cellDiv.innerHTML = '💰';
                document.getElementById('cashOutAmount').innerText = currentTempScore;
                document.getElementById('cashOut').classList.remove('hidden');
                clickSound.play();
            }
            saveGameState();
        }

        function showAllMines() {
            const gridContainer = document.getElementById('grid');
            grid.forEach((cell, index) => {
                const cellDiv = gridContainer.children[index];
                if (cell === -1) {
                    cellDiv.classList.add('game-over');
                    cellDiv.innerHTML = '❌';
                } else if (cell === 1 && bonusCellIndex === index) {
                    cellDiv.classList.add('bonus-cell');
                    cellDiv.innerHTML = '🎁';
                }
            });
        }

        function endGame(isWin) {
            const resultText = document.getElementById('rewardMessage');
            resultText.classList.remove('hidden');
            resultText.innerHTML = isWin
                ? `Вы выиграли! Ваши временные монеты: ${currentTempScore}`
                : `Игра окончена! Вы наткнулись на пустую клетку и потеряли временные монеты.`;

            toggleCellClickability(false);
            clearInterval(timerInterval);
            if (isWin) {
                totalScore += currentTempScore;
                winSound.play();
            }
            document.getElementById('totalBalance').innerText = totalScore;
            document.getElementById('totalBalanceMenu').innerText = totalScore;
            currentTempScore = 0;
            document.getElementById('cashOut').classList.add('hidden');
            document.getElementById('exitButton').classList.remove('hidden');
            drawCard();
            gameInProgress = false;
            saveGameState();
        }

        function drawCard() {
            const rand = Math.random();
            let drawnCard = null;

            if (rand < 0.001) drawnCard = 'Туз';
            else if (rand < 0.01) drawnCard = 'Король';
            else if (rand < 0.03) drawnCard = 'Дама';
            else if (rand < 0.05) drawnCard = 'Валет';

            if (drawnCard) {
                cards[drawnCard].count++;
                updateDeckCount();
                showRewardMessage(`Поздравляю! Вы получили ${drawnCard}!`);
                checkQuestCompletion();
            }
        }

        function showRewardMessage(message) {
            const rewardMessageDiv = document.getElementById('rewardMessage');
            rewardMessageDiv.innerText = message;
            rewardMessageDiv.classList.remove('hidden');

            setTimeout(() => {
                rewardMessageDiv.classList.add('hidden');
            }, 5000);
        }

        function cashOut() {
            totalScore += currentTempScore;
            document.getElementById('totalBalance').innerText = totalScore;
            document.getElementById('totalBalanceMenu').innerText = totalScore;
            currentTempScore = 0;
            usedCells.clear();
            document.getElementById('cashOut').classList.add('hidden');
            resetGame();
            saveGameState();
        }

        function resetGame() {
            document.getElementById('rewardMessage').classList.add('hidden');
            renderGrid();
            clearInterval(timerInterval);
            document.getElementById('freeAttempt').classList.add('hidden');
            toggleCellClickability(false);
            usedCells.clear();
            updateDeckCount();
        }

        function startTimer() {
            let timeRemaining = 2 * 60;
            timerInterval = setInterval(() => {
                const minutes = Math.floor(timeRemaining / 60);
                const seconds = timeRemaining % 60;
                document.getElementById('attemptResetTimer').innerText = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                timeRemaining--;

                if (timeRemaining < 0) {
                    clearInterval(timerInterval);
                    if (attempts < 5) {
                        attempts++;
                        document.getElementById('attempts').innerText = attempts;
                        alert("У вас новая бесплатная попытка!");
                    }
                    startTimer();
                }
            }, 1000);
        }

        function startFreeAttemptTimer() {
            let timeRemaining = 2 * 60;
            timerInterval = setInterval(() => {
                const minutes = Math.floor(timeRemaining / 60);
                const seconds = timeRemaining % 60;
                document.getElementById('attemptResetTimer').innerText = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                timeRemaining--;

                if (timeRemaining < 0) {
                    clearInterval(timerInterval);
                    attempts++;
                    document.getElementById('attempts').innerText = attempts;
                    alert("У вас новая бесплатная попытка!");
                    startFreeAttemptTimer();
                }
            }, 1000);
        }

        function updateMineCount(value) {
            mineCount = value;
            document.getElementById('mineCountDisplay').innerText = value;
            saveGameState();
        }

        function confirmMineCount() {
            mineCount = parseInt(document.getElementById('mineCountDisplay').innerText);
            renderGrid();
            gameInProgress = true;
            saveGameState();
        }

        function showCardInfo(name, rarity, count, ability) {
            document.getElementById('cardTitle').innerText = name;
            document.getElementById('cardRarity').innerText = `Редкость: ${rarity}`;
            document.getElementById('cardCountUpgrade').innerText = `Количество: ${count}`;
            document.getElementById('cardAbility').innerText = ability;
            document.getElementById('upgradeButton').style.display = 'block';
            document.getElementById('cardInfoModal').style.display = 'flex';
        }

        function closeCardInfoModal() {
            document.getElementById('cardInfoModal').style.display = 'none';
        }

        function upgradeCard() {
            const cardName = document.getElementById('cardTitle').innerText;
            const card = cards[cardName];

            if (totalScore >= card.upgradeCost) {
                totalScore -= card.upgradeCost;
                card.level += 1;
                card.upgradeCost = Math.floor(card.upgradeCost * 1.5);
                document.getElementById('totalBalance').innerText = totalScore;
                document.getElementById('totalBalanceMenu').innerText = totalScore;
                updateDeckCount();
                saveGameState();
            }
        }

        function showWelcomeModal() {
            document.getElementById('welcomeModal').style.display = 'flex';
        }

        function closeWelcomeModal() {
            document.getElementById('welcomeModal').style.display = 'none';
        }

        function openQuestModal() {
            document.getElementById('questModal').style.display = 'flex';
        }

        function closeQuestModal() {
            document.getElementById('questModal').style.display = 'none';
        }

        function openQuestInfo(title, description) {
            document.getElementById('questTitle').innerText = title;
            document.getElementById('questDescription').innerText = description;
            document.getElementById('questInfoModal').style.display = 'flex';
        }

        function closeQuestInfoModal() {
            document.getElementById('questInfoModal').style.display = 'none';
        }

        function checkQuestCompletion() {
            const allCardsCollected = Object.values(cards).every(card => card.count > 0);
            if (allCardsCollected) {
                document.getElementById('questRewardButton').classList.remove('hidden');
            } else {
                document.getElementById('questRewardButton').classList.add('hidden');
            }
            updateQuestProgress();
        }

        function updateQuestProgress() {
            const collectedCardsCount = Object.values(cards).filter(card => card.count > 0).length;
            document.querySelectorAll('.quest-progress').forEach(progressElement => {
                progressElement.innerText = `${collectedCardsCount}/4`;
            });
        }

        function claimQuestReward() {
            attempts += 50;
            diamondCount += 5;
            document.getElementById('attempts').innerText = attempts;
            document.getElementById('diamondBalance').innerText = diamondCount;
            document.getElementById('diamondBalanceMenu').innerText = diamondCount;
            document.getElementById('questRewardButton').classList.add('hidden');
            showRewardMessage('Поздравляю! Вы получили 50 попыток и 5 бриллиантов!');
            saveGameState();
        }

        function toggleSnow() {
            snowEnabled = !snowEnabled;
            if (snowEnabled) {
                createSnow();
            } else {
                removeSnow();
            }
        }

        function createSnow() {
            const snowContainer = document.createElement('div');
            snowContainer.style.position = 'fixed';
            snowContainer.style.top = '0';
            snowContainer.style.left = '0';
            snowContainer.style.width = '100%';
            snowContainer.style.height = '100%';
            snowContainer.style.pointerEvents = 'none';
            snowContainer.style.zIndex = '1000';
            document.body.appendChild(snowContainer);

            for (let i = 0; i < 50; i++) {
                const snowflake = document.createElement('div');
                snowflake.className = 'snowflake';
                snowflake.style.left = `${Math.random() * 100}vw`;
                snowflake.style.animationDuration = `${Math.random() * 5 + 5}s`;
                snowflake.style.animationDelay = `${Math.random() * 5}s`;
                snowflake.style.animationTimingFunction = 'linear';
                snowflake.style.transformOrigin = 'center';
                snowflake.style.transform = `rotate(${Math.random() * 360}deg)`;
                snowflake.style.animationName = 'fall';
                snowflake.innerHTML = '⚪';
                snowContainer.appendChild(snowflake);
            }
        }

        function removeSnow() {
            const snowContainer = document.querySelector('div[style="position: fixed; top: 0px; left: 0px; width: 100%; height: 100%; pointer-events: none; z-index: 1000;"]');
            if (snowContainer) {
                snowContainer.remove();
            }
        }

        function openSettingsModal() {
            document.getElementById('settingsModal').style.display = 'flex';
        }

        function closeSettingsModal() {
            document.getElementById('settingsModal').style.display = 'none';
        }

        function changeLanguage() {
            const selectedLanguage = document.getElementById('languageSelect').value;
            if (selectedLanguage === 'en') {
                document.querySelector('.header').innerText = 'CardMoney';
                document.querySelectorAll('button').forEach(button => {
                    if (button.innerText === 'Играть') button.innerText = 'Play';
                    if (button.innerText === 'Колоды') button.innerText = 'Decks';
                    if (button.innerText === 'Задания') button.innerText = 'Quests';
                    if (button.innerText === 'Настройки') button.innerText = 'Settings';
                });
                document.querySelectorAll('h2').forEach(h2 => {
                    if (h2.innerText === 'Выберите игру') h2.innerText = 'Choose a Game';
                    if (h2.innerText === 'Колоды') h2.innerText = 'Decks';
                    if (h2.innerText === 'Карты Классической Колоды') h2.innerText = 'Classic Deck Cards';
                    if (h2.innerText === 'Задания') h2.innerText = 'Quests';
                    if (h2.innerText === 'Настройки') h2.innerText = 'Settings';
                });
                document.querySelectorAll('p').forEach(p => {
                    if (p.innerText === 'Дорогой игрок, если ты хочешь создать свою карту и её видели все игроки, переведи сумму от 50 руб на счет Сбер +79782464846, и введи с сообщением описание своей карты, и карта в скором времени будет добавлена в игру.') {
                        p.innerText = 'Dear player, if you want to create your own card and have it seen by all players, transfer an amount from 50 rubles to the Sber account +79782464846, and enter a description of your card with the message, and the card will be added to the game soon.';
                    }
                    if (p.innerText === 'Привет, поможешь мне собрать всю коллекцию карт играя в эту простую аркадную игру?') {
                        p.innerText = 'Hi, will you help me collect the entire card collection by playing this simple arcade game?';
                    }
                });
                document.querySelectorAll('h3').forEach(h3 => {
                    if (h3.innerText.includes('Попытки:')) {
                        h3.innerText = 'Attempts: ' + h3.innerText.split(':')[1];
                    }
                    if (h3.innerText === 'Угадайте, где спрятаны монеты!') {
                        h3.innerText = 'Guess where the coins are hidden!';
                    }
                    if (h3.innerText.includes('Бесплатная попытка:')) {
                        h3.innerText = 'Free attempt: ' + h3.innerText.split(':')[1];
                    }
                });
                document.querySelectorAll('label').forEach(label => {
                    if (label.innerText === 'Пустые клетки (3-24):') {
                        label.innerText = 'Empty cells (3-24):';
                    }
                });
                document.querySelectorAll('button').forEach(button => {
                    if (button.innerText === 'Начать игру') button.innerText = 'Start Game';
                    if (button.innerText === 'Забрать') button.innerText = 'Cash Out';
                    if (button.innerText === 'Выйти в главное меню') button.innerText = 'Exit to Main Menu';
                    if (button.innerText === 'Смотреть рекламу') button.innerText = 'Watch Ad';
                    if (button.innerText === 'ОК') button.innerText = 'OK';
                    if (button.innerText === 'Получить награду') button.innerText = 'Claim Reward';
                    if (button.innerText === 'Хорошо') button.innerText = 'OK';
                });
                document.querySelectorAll('.quest-name').forEach(questName => {
                    if (questName.innerText === 'Тёте нужно помогать!') {
                        questName.innerText = 'Help Auntie!';
                    }
                });
                document.querySelectorAll('.quest-progress').forEach(questProgress => {
                    questProgress.innerText = questProgress.innerText.replace('0/4', '0/4');
                });
                document.querySelectorAll('.card-name').forEach(cardName => {
                    if (cardName.innerText === 'Валет') cardName.innerText = 'Jack';
                    if (cardName.innerText === 'Дама') cardName.innerText = 'Queen';
                    if (cardName.innerText === 'Король') cardName.innerText = 'King';
                    if (cardName.innerText === 'Туз') cardName.innerText = 'Ace';
                });
                document.querySelectorAll('.deck-name').forEach(deckName => {
                    if (deckName.innerText === 'Классическая') deckName.innerText = 'Classic';
                });
            } else {
                document.querySelector('.header').innerText = 'CardMoney';
                document.querySelectorAll('button').forEach(button => {
                    if (button.innerText === 'Play') button.innerText = 'Играть';
                    if (button.innerText === 'Decks') button.innerText = 'Колоды';
                    if (button.innerText === 'Quests') button.innerText = 'Задания';
                    if (button.innerText === 'Settings') button.innerText = 'Настройки';
                });
                document.querySelectorAll('h2').forEach(h2 => {
                    if (h2.innerText === 'Choose a Game') h2.innerText = 'Выберите игру';
                    if (h2.innerText === 'Decks') h2.innerText = 'Колоды';
                    if (h2.innerText === 'Classic Deck Cards') h2.innerText = 'Карты Классической Колоды';
                    if (h2.innerText === 'Quests') h2.innerText = 'Задания';
                    if (h2.innerText === 'Settings') h2.innerText = 'Настройки';
                });
                document.querySelectorAll('p').forEach(p => {
                    if (p.innerText === 'Dear player, if you want to create your own card and have it seen by all players, transfer an amount from 50 rubles to the Sber account +79782464846, and enter a description of your card with the message, and the card will be added to the game soon.') {
                        p.innerText = 'Дорогой игрок, если ты хочешь создать свою карту и её видели все игроки, переведи сумму от 50 руб на счет Сбер +79782464846, и введи с сообщением описание своей карты, и карта в скором времени будет добавлена в игру.';
                    }
                    if (p.innerText === 'Hi, will you help me collect the entire card collection by playing this simple arcade game?') {
                        p.innerText = 'Привет, поможешь мне собрать всю коллекцию карт играя в эту простую аркадную игру?';
                    }
                });
                document.querySelectorAll('h3').forEach(h3 => {
                    if (h3.innerText.includes('Attempts:')) {
                        h3.innerText = 'Попытки: ' + h3.innerText.split(':')[1];
                    }
                    if (h3.innerText === 'Guess where the coins are hidden!') {
                        h3.innerText = 'Угадайте, где спрятаны монеты!';
                    }
                    if (h3.innerText.includes('Free attempt:')) {
                        h3.innerText = 'Бесплатная попытка: ' + h3.innerText.split(':')[1];
                    }
                });
                document.querySelectorAll('label').forEach(label => {
                    if (label.innerText === 'Empty cells (3-24):') {
                        label.innerText = 'Пустые клетки (3-24):';
                    }
                });
                document.querySelectorAll('button').forEach(button => {
                    if (button.innerText === 'Start Game') button.innerText = 'Начать игру';
                    if (button.innerText === 'Cash Out') button.innerText = 'Забрать';
                    if (button.innerText === 'Exit to Main Menu') button.innerText = 'Выйти в главное меню';
                    if (button.innerText === 'Watch Ad') button.innerText = 'Смотреть рекламу';
                    if (button.innerText === 'OK') button.innerText = 'ОК';
                    if (button.innerText === 'Claim Reward') button.innerText = 'Получить награду';
                    if (button.innerText === 'OK') button.innerText = 'Хорошо';
                });
                document.querySelectorAll('.quest-name').forEach(questName => {
                    if (questName.innerText === 'Help Auntie!') {
                        questName.innerText = 'Тёте нужно помогать!';
                    }
                });
                document.querySelectorAll('.quest-progress').forEach(questProgress => {
                    questProgress.innerText = questProgress.innerText.replace('0/4', '0/4');
                });
                document.querySelectorAll('.card-name').forEach(cardName => {
                    if (cardName.innerText === 'Jack') cardName.innerText = 'Валет';
                    if (cardName.innerText === 'Queen') cardName.innerText = 'Дама';
                    if (cardName.innerText === 'King') cardName.innerText = 'Король';
                    if (cardName.innerText === 'Ace') cardName.innerText = 'Туз';
                });
                document.querySelectorAll('.deck-name').forEach(deckName => {
                    if (deckName.innerText === 'Classic') deckName.innerText = 'Классическая';
                });
            }
        }

        function loadGameState() {
            const savedState = JSON.parse(localStorage.getItem('gameState'));
            if (savedState) {
                totalScore = savedState.totalScore;
                diamondCount = savedState.diamondCount;
                attempts = savedState.attempts;
                cards = savedState.cards;
                mineCount = savedState.mineCount;
            }
        }

        function saveGameState() {
            const gameState = {
                totalScore: totalScore,
                diamondCount: diamondCount,
                attempts: attempts,
                cards: cards,
                mineCount: mineCount
            };
            localStorage.setItem('gameState', JSON.stringify(gameState));
        }

        window.onload = function() {
            loadGameState();
            document.getElementById('totalBalance').innerText = totalScore;
            document.getElementById('diamondBalance').innerText = diamondCount;
            document.getElementById('attempts').innerText = attempts;
            document.getElementById('cashOutAmount').innerText = 0;
            document.getElementById('mineCountDisplay').innerText = mineCount;
            document.getElementById('totalBalanceMenu').innerText = totalScore;
            document.getElementById('diamondBalanceMenu').innerText = diamondCount;

            if (!localStorage.getItem('hasPlayedBefore')) {
                showWelcomeModal();
                localStorage.setItem('hasPlayedBefore', 'true');
            }

            updateQuestProgress();
            startFreeAttemptTimer();
        };

        window.onbeforeunload = function() {
            saveGameState();
        };
    </script>
</body>
</html>
